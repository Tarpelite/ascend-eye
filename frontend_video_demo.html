<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ascend-Eye æ— äººæœºè§†é¢‘ç›‘æ§ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .controls select, .controls button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .controls button {
            background: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .controls button:hover {
            background: #45a049;
        }
        
        .controls button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .video-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .video-card:hover {
            transform: translateY(-5px);
        }
        
        .video-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .uav-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.online {
            background: #44ff44;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .video-container {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: #f0f0f0;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-stream {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .video-placeholder {
            color: #666;
            font-size: 18px;
        }
        
        .video-info {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
        }
        
        .error-message {
            color: #ff4444;
            text-align: center;
            padding: 20px;
            font-weight: bold;
        }
        
        .fullscreen-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸš Ascend-Eye æ— äººæœºç›‘æ§ç³»ç»Ÿ</h1>
        <p>å®æ—¶è§†é¢‘æµç›‘æ§å¹³å°</p>
    </div>
    
    <div class="controls">
        <label for="uavSelect" style="color: white; margin-right: 10px;">é€‰æ‹©æ— äººæœº:</label>
        <select id="uavSelect">
            <option value="all">æ˜¾ç¤ºæ‰€æœ‰</option>
            <option value="5000">UAV-001 (ç«¯å£ 5000)</option>
            <option value="5001">UAV-002 (ç«¯å£ 5001)</option>
            <option value="5002">UAV-003 (ç«¯å£ 5002)</option>
            <option value="5003">UAV-004 (ç«¯å£ 5003)</option>
        </select>
        
        <button onclick="refreshAllStreams()">ğŸ”„ åˆ·æ–°æ‰€æœ‰æµ</button>
        <button onclick="toggleAutoRefresh()">â° è‡ªåŠ¨åˆ·æ–°</button>
        <button onclick="captureScreenshot()">ğŸ“¸ æˆªå›¾</button>
    </div>
    
    <div class="video-grid" id="videoGrid">
        <!-- è§†é¢‘å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>

    <script>
        // æ— äººæœºé…ç½®
        const UAV_CONFIG = [
            { id: 1, port: 5000, name: 'UAV-001', description: 'å·¡é€»åŒºåŸŸ A' },
            { id: 2, port: 5001, name: 'UAV-002', description: 'å·¡é€»åŒºåŸŸ B' },
            { id: 3, port: 5002, name: 'UAV-003', description: 'å·¡é€»åŒºåŸŸ C' },
            { id: 4, port: 5003, name: 'UAV-004', description: 'å·¡é€»åŒºåŸŸ D' }
        ];
        
        let autoRefreshInterval = null;
        let streamStates = {};
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            createVideoCards();
            checkStreamStatus();
            setupEventListeners();
        }
        
        // åˆ›å»ºè§†é¢‘å¡ç‰‡
        function createVideoCards() {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = '';
            
            UAV_CONFIG.forEach(uav => {
                const card = createVideoCard(uav);
                grid.appendChild(card);
                streamStates[uav.port] = { online: false, lastUpdate: null };
            });
        }
        
        // åˆ›å»ºå•ä¸ªè§†é¢‘å¡ç‰‡
        function createVideoCard(uav) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.id = `card-${uav.port}`;
            
            card.innerHTML = `
                <div class="video-header">
                    <div class="uav-title">${uav.name}</div>
                    <div class="status-indicator" id="status-${uav.port}"></div>
                </div>
                
                <div class="video-container">
                    <img id="stream-${uav.port}" 
                         class="video-stream" 
                         src="http://localhost:${uav.port}/video_feed"
                         alt="è§†é¢‘æµåŠ è½½ä¸­..."
                         style="display: none;"
                         onload="onStreamLoad(${uav.port})"
                         onerror="onStreamError(${uav.port})">
                    
                    <div id="placeholder-${uav.port}" class="video-placeholder">
                        è¿æ¥ä¸­...
                    </div>
                    
                    <button class="fullscreen-btn" onclick="toggleFullscreen(${uav.port})">
                        â›¶ å…¨å±
                    </button>
                </div>
                
                <div class="video-info">
                    <strong>æè¿°:</strong> ${uav.description}<br>
                    <strong>ç«¯å£:</strong> ${uav.port}<br>
                    <strong>çŠ¶æ€:</strong> <span id="info-${uav.port}">è¿æ¥ä¸­</span><br>
                    <strong>æœ€åæ›´æ–°:</strong> <span id="time-${uav.port}">--</span>
                </div>
            `;
            
            return card;
        }
        
        // æµåŠ è½½æˆåŠŸå›è°ƒ
        function onStreamLoad(port) {
            console.log(`Stream ${port} loaded successfully`);
            streamStates[port].online = true;
            streamStates[port].lastUpdate = new Date();
            
            document.getElementById(`stream-${port}`).style.display = 'block';
            document.getElementById(`placeholder-${port}`).style.display = 'none';
            document.getElementById(`status-${port}`).classList.add('online');
            document.getElementById(`info-${port}`).textContent = 'åœ¨çº¿';
            document.getElementById(`time-${port}`).textContent = new Date().toLocaleTimeString();
        }
        
        // æµåŠ è½½å¤±è´¥å›è°ƒ
        function onStreamError(port) {
            console.log(`Stream ${port} failed to load`);
            streamStates[port].online = false;
            
            document.getElementById(`stream-${port}`).style.display = 'none';
            document.getElementById(`placeholder-${port}`).innerHTML = `
                <div class="error-message">
                    è¿æ¥å¤±è´¥<br>
                    <small>è¯·ç¡®ä¿ç«¯å£ ${port} çš„æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ</small><br>
                    <button onclick="retryStream(${port})" style="margin-top: 10px; padding: 5px 10px; border: none; background: #007bff; color: white; border-radius: 3px; cursor: pointer;">é‡è¯•</button>
                </div>
            `;
            document.getElementById(`status-${port}`).classList.remove('online');
            document.getElementById(`info-${port}`).textContent = 'ç¦»çº¿';
        }
        
        // é‡è¯•è¿æ¥
        function retryStream(port) {
            console.log(`Retrying stream ${port}`);
            const img = document.getElementById(`stream-${port}`);
            const placeholder = document.getElementById(`placeholder-${port}`);
            
            placeholder.innerHTML = 'é‡æ–°è¿æ¥ä¸­...';
            
            // æ·»åŠ æ—¶é—´æˆ³å¼ºåˆ¶é‡æ–°åŠ è½½
            const timestamp = new Date().getTime();
            img.src = `http://localhost:${port}/video_feed?t=${timestamp}`;
        }
        
        // åˆ·æ–°æ‰€æœ‰æµ
        function refreshAllStreams() {
            UAV_CONFIG.forEach(uav => {
                retryStream(uav.port);
            });
        }
        
        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
        function toggleAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                alert('è‡ªåŠ¨åˆ·æ–°å·²å…³é—­');
            } else {
                autoRefreshInterval = setInterval(refreshAllStreams, 30000); // 30ç§’åˆ·æ–°ä¸€æ¬¡
                alert('è‡ªåŠ¨åˆ·æ–°å·²å¼€å¯ (30ç§’é—´éš”)');
            }
        }
        
        // æˆªå›¾åŠŸèƒ½
        function captureScreenshot() {
            // åˆ›å»ºcanvasæˆªå›¾
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // ç®€å•å®ç°ï¼šæ‰“å¼€æ–°çª—å£æ˜¾ç¤ºå½“å‰æ—¶é—´æˆ³
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            alert(`æˆªå›¾åŠŸèƒ½éœ€è¦é¢å¤–å®ç°\næ—¶é—´æˆ³: ${timestamp}`);
        }
        
        // å…¨å±åˆ‡æ¢
        function toggleFullscreen(port) {
            const img = document.getElementById(`stream-${port}`);
            
            if (img.requestFullscreen) {
                img.requestFullscreen();
            } else if (img.webkitRequestFullscreen) {
                img.webkitRequestFullscreen();
            } else if (img.mozRequestFullScreen) {
                img.mozRequestFullScreen();
            }
        }
        
        // æ£€æŸ¥æµçŠ¶æ€
        function checkStreamStatus() {
            setInterval(() => {
                UAV_CONFIG.forEach(uav => {
                    const timeElement = document.getElementById(`time-${uav.port}`);
                    if (streamStates[uav.port].online && streamStates[uav.port].lastUpdate) {
                        timeElement.textContent = streamStates[uav.port].lastUpdate.toLocaleTimeString();
                    }
                });
            }, 1000);
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            const uavSelect = document.getElementById('uavSelect');
            uavSelect.addEventListener('change', function() {
                const selectedPort = this.value;
                const cards = document.querySelectorAll('.video-card');
                
                if (selectedPort === 'all') {
                    cards.forEach(card => card.style.display = 'block');
                } else {
                    cards.forEach(card => {
                        if (card.id === `card-${selectedPort}`) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                }
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initPage);
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html> 